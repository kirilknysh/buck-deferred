/* buck-deferred v0.1.0 [Distributed under MIT license] */
!function(t,e){function r(t,e,r){for(var s=0;s<r.length;s++)r[s].apply(t,e)}function s(t){var e,r;if(!t||"number"!=typeof t.length)return[];for(e=t.length,r=new Array(e);--e>=0;)r[e]=t[e];return r}function n(){this.successCallbacks=[],this.failCallbacks=[],this.progressCallbacks=[],this._state=o.PENDING,this._resultContext=null,this._resultArguments=null,this._progressContext=null,this._progressArguments=null}var i,o={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"};i=function(){return Array.isArray?function(t){return Array.isArray(t)}:function(t){return"[object Array]"===Object.prototype.toString.call(t)}}(),n.prototype.state=function(){return this._state},n.prototype.promise=function(t){return null==t?this:t},n.prototype.then=function(t,r,s){var n=new e.Deferred;return"function"==typeof t&&this.done(function(){var r=t.apply(this,arguments);r instanceof e.Deferred?r.done(function(){n.resolveWith(null,arguments)}).fail(function(){n.rejectWith(null,arguments)}).progress(function(){n.notifyWith(null,arguments)}):n.resolveWith(this,[r])}),"function"==typeof r&&this.fail(function(){var t=r.apply(this,arguments);t instanceof e.Deferred?t.done(function(){n.resolveWith(null,arguments)}).fail(function(){n.rejectWith(null,arguments)}).progress(function(){n.notifyWith(null,arguments)}):n.rejectWith(this,[t])}),"function"==typeof s&&this.progress(function(){var t=s.apply(this,arguments);t instanceof e.Deferred?t.done(function(){n.resolveWith(null,arguments)}).fail(function(){n.rejectWith(null,arguments)}).progress(function(){n.notifyWith(null,arguments)}):n.notifyWith(this,[t])}),n._promise},n.prototype.fail=function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?(this.failCallbacks.push(arguments[t]),this._state===o.REJECTED&&arguments[t].apply(this._resultContext,this._resultArguments)):i(arguments[t])&&this.fail.apply(this,arguments[t]);return this},n.prototype.always=function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?(this.successCallbacks.push(arguments[t]),this.failCallbacks.push(arguments[t]),this._state!==o.PENDING&&arguments[t].apply(this._resultContext,this._resultArguments)):i(arguments[t])&&this.always.apply(this,arguments[t]);return this},n.prototype.done=function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?(this.successCallbacks.push(arguments[t]),this._state===o.RESOLVED&&arguments[t].apply(this._resultContext,this._resultArguments)):i(arguments[t])&&this.done.apply(this,arguments[t]);return this},n.prototype.progress=function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?(this.progressCallbacks.push(arguments[t]),null!==this._progressContext&&arguments[t].apply(this._progressContext,this._progressArguments)):i(arguments[t])&&this.progress.apply(this,arguments[t]);return this},e.Deferred=function(t){this._promise=new n,"function"==typeof t&&t.call(this,this)},e.Deferred.prototype.state=function(){return this._promise.state()},e.Deferred.prototype.then=function(t,e,r){return this._promise.then.apply(this._promise,arguments)},e.Deferred.prototype.fail=function(){return this._promise.fail.apply(this._promise,arguments),this},e.Deferred.prototype.always=function(){return this._promise.always.apply(this._promise,arguments),this},e.Deferred.prototype.done=function(){return this._promise.done.apply(this._promise,arguments),this},e.Deferred.prototype.progress=function(){return this._promise.progress.apply(this._promise,arguments),this},e.Deferred.prototype.resolve=function(){return this.resolveWith(this._promise,arguments)},e.Deferred.prototype.resolveWith=function(t,e){return this._promise._state!==o.PENDING?this:(this._promise._state=o.RESOLVED,this._promise._resultContext=t||this._promise,this._promise._resultArguments=s(e),r(this._promise._resultContext,this._promise._resultArguments,this._promise.successCallbacks),this)},e.Deferred.prototype.reject=function(){return this.rejectWith(this._promise,arguments)},e.Deferred.prototype.rejectWith=function(t,e){return this._promise._state!==o.PENDING?this:(this._promise._state=o.REJECTED,this._promise._resultContext=t||this._promise,this._promise._resultArguments=s(e),r(this._promise._resultContext,this._promise._resultArguments,this._promise.failCallbacks),this)},e.Deferred.prototype.notify=function(){return this.notifyWith(this._promise,arguments)},e.Deferred.prototype.notifyWith=function(t,e){return this._promise.state()!==o.PENDING?this:(this._promise._progressContext=t||this._promise,this._promise._progressArguments=s(e),r(this._promise._progressContext,this._promise._progressArguments,this._promise.progressCallbacks),this)},e.Deferred.prototype.promise=function(t){return this._promise.promise(t)},e.when=function(){var t,r,i,o,u,p,a,h,l,f=arguments.length,m=f;if(0===f)return(new e.Deferred).resolve().promise();if(1===f)return t=arguments[0],t instanceof e.Deferred?t.promise():t instanceof n?t:(new e.Deferred).resolve(t).promise();for(r=s(arguments),i=new Array(f),p=new Array(f),u=new e.Deferred,a=function(t){return function(e){i[t]=this,r[t]=arguments.length>1?s(arguments):e,m--,1>m&&u.resolveWith(i,r)}},h=function(t){return function(e){i[t]=this,p[t]=arguments.length>1?s(arguments):e,u.notifyWith(i,p)}},l=function(){u.rejectWith(this,arguments)},o=0;f>o;o++)t=r[o],t instanceof e.Deferred||t instanceof n?t.done(a(o)).progress(h(o)).fail(l):m--;return 0===m&&u.resolveWith(i,r),u.promise()}}(this,this.$=this.$||{});