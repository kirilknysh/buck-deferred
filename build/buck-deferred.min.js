/* buck-deferred v0.3.0 [Distributed under MIT license] */
!function(t,e){function n(t,e,n){for(var r=0;r<n.length;r++)n[r].apply(t,e)}function r(t){var e,n;if(!t||"number"!=typeof t.length)return[];for(e=t.length,n=new Array(e);--e>=0;)n[e]=t[e];return n}function s(t,e){var n,r=Object.keys(e),s=Object.keys(i.prototype);for(n=0;n<r.length;n++)t[r[n]]=e[r[n]];for(n=0;n<s.length;n++)t[s[n]]=e[s[n]];return t}function i(){this.successCallbacks=[],this.failCallbacks=[],this.progressCallbacks=[],this._state=o.PENDING,this._resultContext=null,this._resultArguments=null,this._progressContext=null,this._progressArguments=null}var u,o={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"};u=function(){return Array.isArray?function(t){return Array.isArray(t)}:function(t){return"[object Array]"===Object.prototype.toString.call(t)}}(),i.prototype.state=function(){return this._state},i.prototype.promise=function(t){return null==t?this:s(t,this)},i.prototype.then=function(t,n,r){var s=new e.Deferred;return"function"==typeof t&&this.done(function(){var n=t.apply(this,arguments);n instanceof e.Deferred||n instanceof i?n.done(function(){s.resolveWith(null,arguments)}).fail(function(){s.rejectWith(null,arguments)}).progress(function(){s.notifyWith(null,arguments)}):s.resolveWith(this,[n])}),"function"==typeof n&&this.fail(function(){var t=n.apply(this,arguments);t instanceof e.Deferred?t.done(function(){s.resolveWith(null,arguments)}).fail(function(){s.rejectWith(null,arguments)}).progress(function(){s.notifyWith(null,arguments)}):s.rejectWith(this,[t])}),"function"==typeof r&&this.progress(function(){var t=r.apply(this,arguments);t instanceof e.Deferred?t.done(function(){s.resolveWith(null,arguments)}).fail(function(){s.rejectWith(null,arguments)}).progress(function(){s.notifyWith(null,arguments)}):s.notifyWith(this,[t])}),s.promise()},i.prototype.fail=function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?(this.failCallbacks.push(arguments[t]),this._state===o.REJECTED&&arguments[t].apply(this._resultContext,this._resultArguments)):u(arguments[t])&&this.fail.apply(this,arguments[t]);return this},i.prototype.always=function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?(this.successCallbacks.push(arguments[t]),this.failCallbacks.push(arguments[t]),this._state!==o.PENDING&&arguments[t].apply(this._resultContext,this._resultArguments)):u(arguments[t])&&this.always.apply(this,arguments[t]);return this},i.prototype.done=function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?(this.successCallbacks.push(arguments[t]),this._state===o.RESOLVED&&arguments[t].apply(this._resultContext,this._resultArguments)):u(arguments[t])&&this.done.apply(this,arguments[t]);return this},i.prototype.progress=function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?(this.progressCallbacks.push(arguments[t]),null!==this._progressContext&&arguments[t].apply(this._progressContext,this._progressArguments)):u(arguments[t])&&this.progress.apply(this,arguments[t]);return this},e.Deferred=function(t){if(!(this instanceof e.Deferred))return new e.Deferred(t);var s=new i,u=this;"function"==typeof t&&t.call(this,this),this.state=function(){return s.state()},this.resolve=function(){return u.resolveWith(s,arguments)},this.resolveWith=function(t,e){return s._state!==o.PENDING?u:(s._state=o.RESOLVED,s._resultContext=t||s,s._resultArguments=r(e),n(s._resultContext,s._resultArguments,s.successCallbacks),u)},this.reject=function(){return u.rejectWith(s,arguments)},this.rejectWith=function(t,e){return s._state!==o.PENDING?u:(s._state=o.REJECTED,s._resultContext=t||s,s._resultArguments=r(e),n(s._resultContext,s._resultArguments,s.failCallbacks),u)},this.notify=function(){return u.notifyWith(s,arguments)},this.notifyWith=function(t,e){return s.state()!==o.PENDING?u:(s._progressContext=t||s,s._progressArguments=r(e),n(s._progressContext,s._progressArguments,s.progressCallbacks),u)},this.then=function(t,e,n){return s.then.apply(s,arguments)},this.done=function(){return s.done.apply(s,arguments),u},this.fail=function(){return s.fail.apply(s,arguments),u},this.progress=function(){return s.progress.apply(s,arguments),u},this.always=function(){return s.always.apply(s,arguments),u},this.promise=function(t){return s.promise(t)}},e.when=function(){var t,n,s,u,o,a,l,f,h,g=arguments.length,c=g;if(0===g)return(new e.Deferred).resolve().promise();if(1===g)return t=arguments[0],t instanceof e.Deferred?t.promise():t instanceof i?t:(new e.Deferred).resolve(t).promise();for(n=r(arguments),s=new Array(g),a=new Array(g),o=new e.Deferred,l=function(t){return function(e){s[t]=this,n[t]=arguments.length>1?r(arguments):e,c--,1>c&&o.resolveWith(s,n)}},f=function(t){return function(e){s[t]=this,a[t]=arguments.length>1?r(arguments):e,o.notifyWith(s,a)}},h=function(){o.rejectWith(this,arguments)},u=0;g>u;u++)t=n[u],t instanceof e.Deferred||t instanceof i?t.done(l(u)).progress(f(u)).fail(h):c--;return 0===c&&o.resolveWith(s,n),o.promise()}}(this,this.$=this.$||{});